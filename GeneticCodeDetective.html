<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏° (Genetic Code Detective)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans Thai', sans-serif;
        }
        .template-base {
            width: 45px; height: 45px; font-size: 1.1rem;
        }
        @media (min-width: 640px) {
            .template-base { width: 60px; height: 60px; font-size: 1.5rem; }
        }
        .template-base {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 0.5rem;
            user-select: none;
            transition: all 0.2s ease-in-out;
        }

        .base-A { background-color: #84cc16; color: white; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .base-T { background-color: #ef4444; color: white; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        .base-C { background-color: #3b82f6; color: white; } /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
        .base-G { background-color: #f59e0b; color: white; } /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
        
        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .dna-strand {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        .hidden { display: none; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.3s linear; }

        /* Level 4 & 5 Styles */
        .karyotype-container {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center;
            background-color: #1f2937; padding: 1rem; border-radius: 0.5rem;
        }
        .chromosome-pair {
            border: 2px solid #4b5563; padding: 5px 8px; border-radius: 8px;
            text-align: center; cursor: pointer; transition: all 0.2s; min-width: 40px;
        }
        .chromosome-pair:hover { background-color: #374151; }
        .chromosome-pair.correct-selection, .diagnosis-btn.correct-selection {
            border-color: #22c55e; background-color: #16a34a; color: white;
            animation: pulse-green 0.5s;
        }
        .diagnosis-btn {
            padding: 0.75rem 1rem; background-color: #4f46e5; color: white;
            border: none; border-radius: 0.5rem; font-weight: bold; cursor: pointer;
            transition: background-color 0.2s;
        }
        .diagnosis-btn:hover:not(:disabled) { background-color: #4338ca; }
        .diagnosis-btn:disabled {
            background-color: #4b5563; cursor: not-allowed; opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-2 sm:p-4">

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 bg-gray-900 flex items-center justify-center p-4 z-50 text-white text-center">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl max-w-2xl w-full border-4 border-indigo-500">
            <h1 class="text-3xl sm:text-5xl font-bold text-indigo-400">üß¨ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà üïµÔ∏è<br>‡πÄ‡∏Å‡∏°‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°</h1>
            <p class="text-lg sm:text-xl mt-4 mb-6 text-gray-300">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á DNA, ‡∏¢‡∏µ‡∏ô, ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</p>
            <input type="text" id="player-name-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full max-w-sm mx-auto mb-6 p-3 rounded-lg bg-gray-700 border-2 border-gray-600 focus:border-indigo-500 focus:ring-indigo-500 text-white text-center text-lg">
            <button id="start-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-10 rounded-lg text-2xl transition duration-300 transform hover:scale-105">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!
            </button>
        </div>
    </div>

    <div id="game-container" class="bg-gray-800 p-2 sm:p-8 rounded-2xl shadow-2xl w-full max-w-4xl mx-auto border-4 border-indigo-500 hidden">
        <header class="text-center mb-4 sm:mb-6">
            <h1 class="text-2xl sm:text-4xl font-bold text-indigo-400">üß¨ ‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏° üïµÔ∏è</h1>
            <p id="level-title" class="text-md sm:text-xl text-gray-300 mt-2">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™ DNA ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
        </header>

        <main>
            <!-- Mission Description -->
            <div id="mission-description" class="bg-gray-700 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6 text-center text-sm sm:text-lg">
                ...
            </div>

            <!-- Game Area for Levels 1-4 -->
            <div id="game-area" class="space-y-4 sm:space-y-6">
                <!-- DNA Template Strand (Levels 1, 3, 4) -->
                <div id="template-area" class="text-center">
                    <h3 id="template-strand-title" class="text-md sm:text-lg font-semibold mb-2 text-gray-400">...</h3>
                    <div id="template-strand" class="dna-strand"></div>
                </div>

                <!-- Player's Interaction Area -->
                <div id="player-area" class="text-center">
                     <h3 id="player-strand-title" class="text-lg font-semibold mb-2 text-gray-400">...</h3>
                    <div id="player-strand" class="dna-strand"></div>
                     <div id="input-area" class="flex justify-center items-center gap-2 mt-4">
                        <input type="text" id="dna-input" class="bg-gray-900 text-white font-mono text-xl text-center tracking-widest p-2 rounded-lg border-2 border-gray-500 w-full max-w-xs" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏™">
                        <button id="submit-answer-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold p-2 rounded-lg text-lg">‚úîÔ∏è</button>
                    </div>
                </div>
            </div>
            
            <!-- Level 2-3 Shared Content -->
            <div id="level-2-content" class="hidden mt-4 sm:mt-6 flex flex-col items-center justify-center gap-4 sm:gap-6">
                <div id="gene-table-container">
                    <h3 class="text-md sm:text-lg font-semibold mb-2 text-gray-400 text-center">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏µ‡∏ô</h3>
                    <table id="gene-table" class="bg-gray-700 rounded-lg overflow-hidden text-xs sm:text-sm md:text-base">
                        <thead class="bg-gray-900">
                            <tr>
                                <th class="p-1 sm:p-2 md:p-3">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ (Trait)</th>
                                <th class="p-1 sm:p-2 md:p-3">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏™ (Gene Sequence)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Gene info will be inserted here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Level 5 Area -->
            <div id="level-5-area" class="hidden text-center">
                <div id="symptom-display" class="bg-gray-700 p-4 rounded-lg mb-6 text-lg min-h-[6rem] flex items-center justify-center">
                    <!-- Symptom text will appear here -->
                </div>
                <div id="syndrome-choices" class="flex flex-col sm:flex-row justify-center gap-4">
                    <!-- Choice buttons will be generated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for messages -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-2xl p-6 sm:p-8 text-center shadow-xl border-4 border-indigo-500 max-w-md w-full transform transition-all scale-95 opacity-0" id="modal-content">
            <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold text-indigo-400 mb-4"></h2>
            <p id="modal-message" class="text-md sm:text-lg text-gray-300 mb-6 whitespace-pre-line"></p>
            <button id="modal-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300 transform hover:scale-105">
                ‡πÑ‡∏õ‡∏ï‡πà‡∏≠!
            </button>
        </div>
    </div>

    <!-- Final congratulations screen -->
    <div id="final-screen" class="hidden fixed inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4 z-50 text-white text-center">
        <div class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl max-w-3xl w-full border-4 border-amber-400 transform transition-all scale-95 opacity-0" id="final-content">
            <h2 class="text-3xl sm:text-4xl font-bold text-amber-400 mb-4">üéâ ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ! üéâ</h2>
            <p class="text-lg sm:text-xl mb-6">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°!</p>
            
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8 text-md sm:text-lg mb-6 bg-gray-900 p-3 rounded-lg">
                <div><strong>üë©‚Äçüî¨ ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö:</strong> <span id="final-player-name"></span></div>
                <div><strong>‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</strong> <span id="final-time"></span></div>
                <div><strong>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</strong> <span id="final-score"></span></div>
            </div>

            <div class="text-left bg-gray-700 p-4 sm:p-6 rounded-lg">
                <h3 class="text-xl sm:text-2xl font-semibold text-indigo-400 mb-4">‡∏Å‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏≤‡∏á DNA</h3>
                <p class="mb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÄ‡∏ä‡πà‡∏ô:</p>
                <ul class="list-disc list-inside space-y-3">
                    <li><strong>‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° (Genetic Engineering):</strong> ‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏¢‡∏µ‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡∏ä‡∏ó‡∏ô‡πÅ‡∏•‡πâ‡∏á (GMOs) ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏¢‡∏≤‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢</li>
                    <li><strong>‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏¢‡∏µ‡∏ô (Gene Therapy):</strong> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£ "‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ó‡∏î‡πÅ‡∏ó‡∏ô" ‡∏¢‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</li>
                    <li><strong>‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠‡∏î‡∏µ‡πÄ‡∏≠‡πá‡∏ô‡πÄ‡∏≠ (DNA Fingerprinting):</strong> ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ô‡∏¥‡∏ï‡∏¥‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏¢‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥‡πÑ‡∏õ!</li>
                    <li><strong>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personalized Medicine):</strong> ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏≠‡∏≤‡∏à‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</li>
                </ul>
                <p class="mt-6 font-semibold">‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢ ‡∏à‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞!</p>
            </div>

        </div>
    </div>


    <script>
        let startTime;
        let playerName = "‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö";
        let gameScore = 0; // New score variable

        const gameConfig = {
            level: 1,
            levels: {
                1: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™ DNA ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                    mission: "‡∏à‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏™‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                    sequence: [],
                },
                2: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏à‡∏≤‡∏Å‡∏¢‡∏µ‡∏ô‡∏™‡∏π‡πà‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ (‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢)",
                    mission: "",
                    targetTrait: '‡∏ï‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤',
                    genes: {
                        '‡∏ï‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤': { sequence: ['A', 'T', 'T', 'C', 'G', 'A'] },
                        '‡∏ï‡∏≤‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß': { sequence: ['G', 'C', 'C', 'A', 'T', 'G'] },
                        '‡∏ú‡∏°‡∏™‡∏µ‡∏î‡∏≥': { sequence: ['C', 'G', 'A', 'T', 'A', 'T'] },
                    },
                },
                3: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏¥‡∏ß‡πÄ‡∏ó‡∏ä‡∏±‡∏ô! (‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢)",
                    mission: "",
                    originalTrait: '',
                    sequence: [],
                },
                4: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°",
                    mission: "‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏î",
                    stage: 'guessing',
                    currentCase: null,
                    unsolvedCases: [],
                    cases: {
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå': { name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå (Down Syndrome)", errorChromosome: 21, description: "‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 21 ‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤ 1 ‡πÅ‡∏ó‡πà‡∏á", symptoms: "‚Ä¢ ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ï‡πà‡∏≥\n‚Ä¢ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢\n‚Ä¢ ‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏≠‡∏¢‡πÅ‡∏ö‡∏ô ‡∏ï‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏∂‡πâ‡∏ô\n‚Ä¢ ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏û‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î" },
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå': { name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå (Cri-du-chat Syndrome)", errorChromosome: 5, description: "‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 5 ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ", symptoms: "‚Ä¢ ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å\n‚Ä¢ ‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÄ‡∏•‡πá‡∏Å ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏°\n‚Ä¢ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏´‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏°‡∏ß" },
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå': { name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå (Turner Syndrome)", errorChromosome: 'X', description: "‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° X ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (XO)", symptoms: "‚Ä¢ ‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢\n‚Ä¢ ‡∏Ñ‡∏≠‡∏°‡∏µ‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î‡∏Å‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏Å\n‚Ä¢ ‡∏£‡∏±‡∏á‡πÑ‡∏Ç‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏±‡∏ô" }
                    },
                    chromosomeFound: false,
                },
                 5: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ",
                    mission: "‡∏≠‡πà‡∏≤‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                    completed: 0,
                    symptomPool: [],
                    currentSymptom: null,
                    pairs: [
                        { symptom: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏´‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏°‡∏ß", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" }, { symptom: "‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏≠‡∏¢‡πÅ‡∏ö‡∏ô ‡∏ï‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏∂‡πâ‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" }, { symptom: "‡∏Ñ‡∏≠‡∏°‡∏µ‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î‡∏Å‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏Å (‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á)", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" }, { symptom: "‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" }, { symptom: "‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÄ‡∏•‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏°", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" }, { symptom: "‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏±‡∏á‡πÑ‡∏Ç‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏£‡∏¥‡∏ç", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" }, { symptom: "‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏∏‡∏Å‡∏õ‡∏≤‡∏Å ‡πÄ‡∏™‡πâ‡∏ô‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡∏î‡∏Ç‡∏ß‡∏≤‡∏á", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" }, { symptom: "‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" }, { symptom: "‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" }, { symptom: "‡∏î‡∏±‡πâ‡∏á‡∏à‡∏°‡∏π‡∏Å‡πÅ‡∏ö‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" }
                    ]
                }
            },
            baseComplements: { 'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C' }
        };

        const levelTitleEl = document.getElementById('level-title');
        const missionDescriptionEl = document.getElementById('mission-description');
        const gameAreaEl = document.getElementById('game-area');
        const level5AreaEl = document.getElementById('level-5-area');
        const templateAreaEl = document.getElementById('template-area');
        const templateStrandTitleEl = document.getElementById('template-strand-title');
        const templateStrandEl = document.getElementById('template-strand');
        const playerAreaEl = document.getElementById('player-area');
        const playerStrandTitleEl = document.getElementById('player-strand-title');
        const playerStrandEl = document.getElementById('player-strand');
        const level2ContentEl = document.getElementById('level-2-content');
        const geneTableBodyEl = document.querySelector('#gene-table tbody');
        const inputAreaEl = document.getElementById('input-area');
        
        const modalEl = document.getElementById('modal');
        const modalContentEl = document.getElementById('modal-content');
        const modalTitleEl = document.getElementById('modal-title');
        const modalMessageEl = document.getElementById('modal-message');
        const modalButtonEl = document.getElementById('modal-button');

        function setupLevel(level) {
            const config = gameConfig.levels[level];
            levelTitleEl.textContent = config.title;
            missionDescriptionEl.textContent = config.mission;
            
            gameAreaEl.classList.add('hidden');
            level2ContentEl.classList.add('hidden');
            level5AreaEl.classList.add('hidden');
            inputAreaEl.classList.add('hidden');

            if (level === 1) setupLevel1();
            else if (level === 2) setupLevel2();
            else if (level === 3) setupLevel3();
            else if (level === 4) {
                const configLvl4 = gameConfig.levels[4];
                if (configLvl4.unsolvedCases.length === 0) {
                    const caseKeys = Object.keys(configLvl4.cases);
                     for (let i = caseKeys.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [caseKeys[i], caseKeys[j]] = [caseKeys[j], caseKeys[i]];
                    }
                    configLvl4.unsolvedCases = caseKeys;
                }
                setupLevel4();
            } else if (level === 5) setupLevel5();
        }
        
        function setupLevel1() {
            gameAreaEl.classList.remove('hidden');
            templateAreaEl.classList.remove('hidden');
            playerAreaEl.classList.remove('hidden');
            inputAreaEl.classList.remove('hidden');
            playerStrandEl.classList.add('hidden');

            const config = gameConfig.levels[1];
            const bases = ['A', 'T', 'C', 'G'];
            let newSequence = [...bases];
            const desiredLength = 6;
            
            while (newSequence.length < desiredLength) {
                newSequence.push(bases[Math.floor(Math.random() * bases.length)]);
            }
            for (let i = newSequence.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newSequence[i], newSequence[j]] = [newSequence[j], newSequence[i]];
            }
            config.sequence = newSequence;

            templateStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö (Template)';
            playerStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏° (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö)';
            templateStrandEl.innerHTML = '';

            config.sequence.forEach(base => {
                const templateBase = document.createElement('div');
                templateBase.className = `template-base base-${base}`;
                templateBase.textContent = base;
                templateStrandEl.appendChild(templateBase);
            });
            
            document.getElementById('submit-answer-btn').onclick = checkTextInputAnswer;
        }
        
        function setupLevel2() {
            gameAreaEl.classList.remove('hidden');
            playerAreaEl.classList.remove('hidden');
            inputAreaEl.classList.remove('hidden');
            level2ContentEl.classList.remove('hidden');
            templateAreaEl.classList.add('hidden');
            playerStrandEl.classList.add('hidden');

            const config = gameConfig.levels[2];
            const availableTraits = Object.keys(config.genes);
            const randomTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
            config.targetTrait = randomTrait;

            config.mission = `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏° (Complementary) ‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '${config.targetTrait}' ‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á`;
            missionDescriptionEl.textContent = config.mission;
            
            playerStrandTitleEl.textContent = `‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${config.targetTrait}' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà`;

            geneTableBodyEl.innerHTML = '';
            for (const trait in config.genes) {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600';
                row.innerHTML = `<td class="p-1 sm:p-2 md:p-3">${trait}</td><td class="p-1 sm:p-2 md:p-3 font-mono">${config.genes[trait].sequence.join('-')}</td>`;
                geneTableBodyEl.appendChild(row);
            }
            document.getElementById('submit-answer-btn').onclick = checkTextInputAnswer;
        }
        
        function setupLevel3() {
            gameAreaEl.classList.remove('hidden');
            playerAreaEl.classList.remove('hidden');
            inputAreaEl.classList.remove('hidden');
            level2ContentEl.classList.remove('hidden');
            templateAreaEl.classList.remove('hidden');
            playerStrandEl.classList.add('hidden');

            const level2Genes = gameConfig.levels[2].genes;
            const level3Config = gameConfig.levels[3];
            const availableTraits = Object.keys(level2Genes);
            const originalTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
            level3Config.originalTrait = originalTrait;

            const originalSequence = [...level2Genes[originalTrait].sequence];
            const mutationIndex = Math.floor(Math.random() * originalSequence.length);
            const originalBase = originalSequence[mutationIndex];
            const possibleBases = ['A', 'T', 'C', 'G'].filter(b => b !== originalBase);
            const mutatedBase = possibleBases[Math.floor(Math.random() * possibleBases.length)];
            const mutatedSequence = [...originalSequence];
            mutatedSequence[mutationIndex] = mutatedBase;
            level3Config.sequence = mutatedSequence;
            
            level3Config.mission = `üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏¥‡∏ß‡πÄ‡∏ó‡∏ä‡∏±‡∏ô! ‡∏™‡∏≤‡∏¢ DNA ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ú‡∏¥‡∏î‡πÑ‡∏õ 1 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${originalTrait}' ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà`;
            missionDescriptionEl.textContent = level3Config.mission;
            templateStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå (Mutated)';
            playerStrandTitleEl.textContent = `‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${originalTrait}' ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;
            
            templateStrandEl.innerHTML = '';
            mutatedSequence.forEach((base) => {
                const templateBase = document.createElement('div');
                templateBase.className = `template-base base-${base}`;
                templateBase.textContent = base;
                templateStrandEl.appendChild(templateBase);
            });
            
            document.getElementById('submit-answer-btn').onclick = checkTextInputAnswer;
        }

        function setupLevel4() {
            gameAreaEl.classList.remove('hidden');
            templateAreaEl.classList.remove('hidden');
            playerAreaEl.classList.remove('hidden');
            playerStrandEl.classList.remove('hidden');
            inputAreaEl.classList.add('hidden');

            const config = gameConfig.levels[4];
            if (config.unsolvedCases.length === 0) {
                 setupLevel(5); 
                 return;
            }

            config.stage = 'guessing';
            config.chromosomeFound = false;
            
            const currentCaseKey = config.unsolvedCases[0];
            config.currentCase = config.cases[currentCaseKey];

            missionDescriptionEl.textContent = config.mission;
            
            templateStrandEl.innerHTML = '';
            templateStrandEl.className = 'dna-strand justify-center';
            const symptomsEl = document.createElement('div');
            symptomsEl.className = 'bg-gray-700 p-4 rounded-lg text-left whitespace-pre-line max-w-md';
            symptomsEl.textContent = config.currentCase.symptoms;
            templateStrandEl.appendChild(symptomsEl);
            
            templateStrandTitleEl.textContent = "‡πÅ‡∏ü‡πâ‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ";
            playerStrandTitleEl.textContent = "‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£";

            playerStrandEl.innerHTML = '';
            Object.keys(config.cases).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'diagnosis-btn';
                btn.textContent = key;
                btn.dataset.syndrome = key;
                btn.disabled = false;
                btn.addEventListener('click', handleDiagnosisClick);
                playerStrandEl.appendChild(btn);
            });
        }
        
        function setupLevel5() {
            gameAreaEl.classList.add('hidden');
            level5AreaEl.classList.remove('hidden');

            const config = gameConfig.levels[5];
            missionDescriptionEl.textContent = config.mission;
            
            if (config.symptomPool.length === 0) {
                 config.symptomPool = [...config.pairs].sort(() => Math.random() - 0.5);
            }
            config.completed = 0;
            displayNextSymptom();
        }
        
        function displayNextSymptom() {
            const config = gameConfig.levels[5];
            const symptomDisplay = document.getElementById('symptom-display');
            const syndromeChoices = document.getElementById('syndrome-choices');
            
            if (config.completed >= config.pairs.length) {
                showModal('‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°!', '‡∏î‡∏π‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', showFinalScreen);
                return;
            }

            config.currentSymptom = config.symptomPool[config.completed];
            symptomDisplay.textContent = config.currentSymptom.symptom;

            syndromeChoices.innerHTML = '';
            Object.keys(gameConfig.levels[4].cases).forEach(syndrome => {
                const btn = document.createElement('button');
                btn.className = 'diagnosis-btn';
                btn.textContent = syndrome;
                btn.dataset.syndrome = syndrome;
                btn.onclick = handleSyndromeChoice;
                syndromeChoices.appendChild(btn);
            });
        }
        
        function handleSyndromeChoice(e) {
            const config = gameConfig.levels[5];
            const chosenSyndrome = e.target.dataset.syndrome;
            
            document.querySelectorAll('#syndrome-choices .diagnosis-btn').forEach(btn => btn.disabled = true);

            if (chosenSyndrome === config.currentSymptom.syndrome) {
                gameScore += 2;
                e.target.classList.add('correct-selection');
                config.completed++;
                levelTitleEl.textContent = `${config.title} (${config.completed}/${config.pairs.length})`;
                setTimeout(displayNextSymptom, 1000);
            } else {
                gameScore -= 1;
                e.target.classList.add('shake');
                setTimeout(() => {
                    e.target.classList.remove('shake');
                     document.querySelectorAll('#syndrome-choices .diagnosis-btn').forEach(btn => btn.disabled = false);
                }, 500);
            }
        }

        function checkTextInputAnswer() {
            const level = gameConfig.level;
            const config = gameConfig.levels[level];
            const inputEl = document.getElementById('dna-input');
            const userInput = inputEl.value.trim().toUpperCase().replace(/[^ATCG]/g, '');

            let correctAnswer = '';
            if (level === 1) {
                correctAnswer = config.sequence.map(base => gameConfig.baseComplements[base]).join('');
            } else if (level === 2) {
                correctAnswer = config.genes[config.targetTrait].sequence.map(base => gameConfig.baseComplements[base]).join('');
            } else if (level === 3) {
                const originalSequence = gameConfig.levels[2].genes[config.originalTrait].sequence;
                correctAnswer = originalSequence.map(base => gameConfig.baseComplements[base]).join('');
            }

            if (userInput === correctAnswer) {
                gameScore += 2;
                inputEl.value = '';
                if (level === 1) {
                    showModal('‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!', '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß!', '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2', () => { gameConfig.level = 2; setupLevel(2); });
                } else if (level === 2) {
                    showModal('‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å!', `‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '${config.targetTrait}' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3', () => { gameConfig.level = 3; setupLevel(3); });
                } else if (level === 3) {
                    showModal('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ñ‡∏∏‡∏ì‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏£‡∏´‡∏±‡∏™ DNA ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ!', '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4', () => { gameConfig.level = 4; setupLevel(4); });
                }
            } else {
                gameScore -= 1;
                inputEl.classList.add('shake');
                setTimeout(() => inputEl.classList.remove('shake'), 300);
            }
        }

        function createChromosomePair(num, caseData) {
            const pair = document.createElement('div');
            pair.className = 'chromosome-pair';
            pair.dataset.chromosome = num;
            pair.textContent = `${num}`;
            if (num === caseData.errorChromosome) pair.dataset.correct = 'true';
            if (caseData.name.includes('‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå') && num === 'Y') pair.style.display = 'none';
            pair.addEventListener('click', handleKaryotypeClick);
            return pair;
        }
        
        function handleDiagnosisClick(e) {
            const config = gameConfig.levels[4];
            if (config.stage !== 'guessing') return;

            const clickedBtn = e.currentTarget;
            const selectedSyndrome = clickedBtn.dataset.syndrome;
            const currentCase = config.currentCase;

            if (selectedSyndrome === currentCase.name.split(' (')[0]) {
                gameScore += 2;
                config.stage = 'confirming';
                missionDescriptionEl.textContent = "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏ó‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Karyotype ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô";

                playerStrandEl.querySelectorAll('.diagnosis-btn').forEach(btn => btn.disabled = true);
                clickedBtn.classList.add('correct-selection');
                
                templateStrandEl.innerHTML = '';
                templateStrandEl.className = 'karyotype-container';
                templateStrandTitleEl.textContent = "Karyotype ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥)";
                playerStrandTitleEl.textContent = "‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß)";

                for (let i = 1; i <= 22; i++) templateStrandEl.appendChild(createChromosomePair(i, currentCase));
                templateStrandEl.appendChild(createChromosomePair('X', currentCase));
                templateStrandEl.appendChild(createChromosomePair('Y', currentCase));

            } else {
                gameScore -= 1;
                clickedBtn.classList.add('shake');
                setTimeout(() => clickedBtn.classList.remove('shake'), 300);
            }
        }
        
        function handleKaryotypeClick(e) {
            const config = gameConfig.levels[4];
            if (config.stage !== 'confirming' || config.chromosomeFound) return;
            
            const clickedPair = e.currentTarget;
            if (clickedPair.dataset.correct === 'true') {
                gameScore += 2;
                config.chromosomeFound = true;
                clickedPair.classList.add('correct-selection');
                missionDescriptionEl.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á";
                
                const currentCase = config.currentCase;
                config.unsolvedCases.shift();
                const moreCases = config.unsolvedCases.length > 0;

                setTimeout(() => {
                    showModal(
                        '‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        `‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏õ‡πá‡∏ô ${currentCase.name}\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ${currentCase.description}\n\n‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡πà‡∏ô:\n${currentCase.symptoms}`,
                        moreCases ? '‡∏Ñ‡∏î‡∏µ‡∏ï‡πà‡∏≠‡πÑ‡∏õ' : '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5',
                        moreCases ? setupLevel4 : () => { gameConfig.level = 5; setupLevel(5); }
                    );
                }, 1200);

            } else {
                gameScore -= 1;
                clickedPair.classList.add('shake');
                setTimeout(() => clickedPair.classList.remove('shake'), 300);
            }
        }
        
        function showModal(title, message, buttonText, callback) {
            modalTitleEl.textContent = title;
            modalMessageEl.textContent = message;
            modalButtonEl.textContent = buttonText;
            
            modalButtonEl.onclick = () => {
                modalContentEl.classList.remove('scale-100', 'opacity-100');
                modalContentEl.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modalEl.classList.add('hidden');
                    if (callback) callback();
                }, 200);
            };
            
            modalEl.classList.remove('hidden');
            setTimeout(() => {
                modalContentEl.classList.remove('scale-95', 'opacity-0');
                modalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function showFinalScreen() {
            const endTime = new Date();
            const timeDiff = endTime - startTime;
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);

            let timeScore = 0;
            const totalMinutes = timeDiff / 60000;
            if (totalMinutes < 2) timeScore = 5;
            else if (totalMinutes <= 5) timeScore = 4;
            else if (totalMinutes <= 8) timeScore = 3;
            else if (totalMinutes <= 10) timeScore = 2;
            else timeScore = 1;

            const maxQuestionScore = (2 * 3) + (Object.keys(gameConfig.levels[4].cases).length * 4) + (gameConfig.levels[5].pairs.length * 2);
            const maxTimeScore = 5;
            const maxTotalPossibleScore = maxQuestionScore + maxTimeScore;
            
            const rawTotalScore = gameScore + timeScore;
            
            let finalScore = (rawTotalScore / maxTotalPossibleScore) * 10;
            finalScore = Math.max(0, finalScore);
            finalScore = Math.min(10, finalScore);

            document.getElementById('final-player-name').textContent = playerName;
            document.getElementById('final-time').textContent = `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds.toString().padStart(2, '0')} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
            document.getElementById('final-score').textContent = `${finalScore.toFixed(1)} / 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
            
            const finalScreenEl = document.getElementById('final-screen');
            const finalContentEl = document.getElementById('final-content');
            
            document.getElementById('game-container').classList.add('hidden');
            modalEl.classList.add('hidden');

            finalScreenEl.classList.remove('hidden');
            setTimeout(() => {
                finalContentEl.classList.remove('scale-95', 'opacity-0');
                finalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        window.onload = () => {
            document.getElementById('start-button').addEventListener('click', () => {
                const nameInput = document.getElementById('player-name-input').value.trim();
                if (nameInput) {
                    playerName = nameInput;
                }

                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('game-container').classList.remove('hidden');
                startTime = new Date(); // Start timer on click
                setupLevel(1); // Setup level 1 on click
            });
        };
    </script>
</body>
</html>

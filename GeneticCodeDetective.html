<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏° (Genetic Code Detective)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans Thai', sans-serif;
        }
        .base {
            width: 50px; height: 50px; font-size: 1.25rem;
        }
        @media (min-width: 640px) {
            .base { width: 60px; height: 60px; font-size: 1.5rem; }
        }
        .base, .template-base {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 0.5rem;
            user-select: none;
            transition: all 0.2s ease-in-out;
        }
        .base {
            cursor: grab;
            border: 2px solid rgba(0,0,0,0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .base:active {
            cursor: grabbing;
            transform: scale(1.1);
            box-shadow: 0 8px 12px rgba(0,0,0,0.2);
        }
        .base-A { background-color: #84cc16; color: white; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .base-T { background-color: #ef4444; color: white; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        .base-C { background-color: #3b82f6; color: white; } /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
        .base-G { background-color: #f59e0b; color: white; } /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */

        .drop-zone, .template-base {
             width: 50px; height: 50px; font-size: 1.25rem;
        }
        @media (min-width: 640px) {
            .drop-zone, .template-base { width: 60px; height: 60px; font-size: 1.5rem; }
        }
        
        .drop-zone {
            border: 3px dashed #9ca3af;
            background-color: #f3f4f6;
        }
        .drop-zone.hovered {
            background-color: #e5e7eb;
            border-color: #6b7280;
        }
        .drop-zone.correct {
            border: 3px solid #22c55e;
            animation: pulse-green 0.5s;
        }
        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .dna-strand {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        .hidden { display: none; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.3s linear; }

        /* Level 4 & 5 Styles */
        .karyotype-container {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center;
            background-color: #1f2937; padding: 1rem; border-radius: 0.5rem;
        }
        .chromosome-pair {
            border: 2px solid #4b5563; padding: 5px 8px; border-radius: 8px;
            text-align: center; cursor: pointer; transition: all 0.2s; min-width: 40px;
        }
        .chromosome-pair:hover { background-color: #374151; }
        .chromosome-pair.correct-selection {
            border-color: #22c55e; background-color: #16a34a; color: white;
            animation: pulse-green 0.5s;
        }
        .diagnosis-btn {
            padding: 0.75rem 1rem; background-color: #4f46e5; color: white;
            border: none; border-radius: 0.5rem; font-weight: bold; cursor: pointer;
            transition: background-color 0.2s;
        }
        .diagnosis-btn:hover:not(:disabled) { background-color: #4338ca; }
        .diagnosis-btn:disabled {
            background-color: #4b5563; cursor: not-allowed; opacity: 0.7;
        }
        .symptom-item {
            transition: opacity 0.2s;
        }
        .syndrome-dropzone {
            transition: all 0.2s;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-2 sm:p-4">

    <!-- Start Screen -->
    <div id="start-screen" class="fixed inset-0 bg-gray-900 flex items-center justify-center p-4 z-50 text-white text-center">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl max-w-2xl w-full border-4 border-indigo-500">
            <h1 class="text-3xl sm:text-5xl font-bold text-indigo-400">üß¨ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà üïµÔ∏è<br>‡πÄ‡∏Å‡∏°‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°</h1>
            <p class="text-lg sm:text-xl mt-4 mb-6 text-gray-300">‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á DNA, ‡∏¢‡∏µ‡∏ô, ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÑ‡∏Ç‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</p>
            <input type="text" id="player-name-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full max-w-sm mx-auto mb-6 p-3 rounded-lg bg-gray-700 border-2 border-gray-600 focus:border-indigo-500 focus:ring-indigo-500 text-white text-center text-lg">
            <button id="start-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-10 rounded-lg text-2xl transition duration-300 transform hover:scale-105">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!
            </button>
        </div>
    </div>

    <div id="game-container" class="bg-gray-800 p-4 sm:p-8 rounded-2xl shadow-2xl w-full max-w-4xl mx-auto border-4 border-indigo-500 hidden">
        <header class="text-center mb-6">
            <h1 class="text-2xl sm:text-4xl font-bold text-indigo-400">üß¨ ‡∏™‡∏≤‡∏¢‡∏•‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏° üïµÔ∏è</h1>
            <p id="level-title" class="text-lg sm:text-xl text-gray-300 mt-2">‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™ DNA ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</p>
        </header>

        <main>
            <!-- Mission Description -->
            <div id="mission-description" class="bg-gray-700 p-4 rounded-lg mb-6 text-center text-md sm:text-lg">
                ‡∏•‡∏≤‡∏Å‡πÄ‡∏ö‡∏™ (A, T, C, G) ‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÑ‡∏õ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!
            </div>

            <!-- Level 1-4 Game Area -->
            <div id="game-area" class="space-y-6">
                <!-- DNA Template Strand -->
                <div id="template-area" class="text-center">
                    <h3 id="template-strand-title" class="text-lg font-semibold mb-2 text-gray-400">‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö (Template)</h3>
                    <div id="template-strand" class="dna-strand"></div>
                </div>

                <!-- Player's Interaction Strand -->
                <div id="player-area" class="text-center">
                     <h3 id="player-strand-title" class="text-lg font-semibold mb-2 text-gray-400">‡∏™‡∏≤‡∏¢ DNA ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏•‡∏≤‡∏Å‡πÄ‡∏ö‡∏™‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)</h3>
                    <div id="player-strand" class="dna-strand"></div>
                </div>
            </div>
            
            <!-- Level 2-3 Shared Content -->
            <div id="level-2-content" class="hidden mt-6 flex flex-col md:flex-row items-center justify-around gap-6">
                <div id="avatar-container" class="text-center">
                    <h3 class="text-lg font-semibold mb-2 text-gray-400">‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                    <div id="avatar" class="w-40 h-40 bg-gray-600 rounded-full flex items-center justify-center text-6xl border-4 border-gray-500 transition-all duration-500">
                        üòê
                    </div>
                     <p id="trait-display" class="mt-2 text-lg font-medium h-8"></p>
                </div>
                <div id="gene-table-container">
                    <h3 class="text-lg font-semibold mb-2 text-gray-400 text-center">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏µ‡∏ô</h3>
                    <table id="gene-table" class="bg-gray-700 rounded-lg overflow-hidden">
                        <thead class="bg-gray-900">
                            <tr>
                                <th class="p-3">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ (Trait)</th>
                                <th class="p-3">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏™ (Gene Sequence)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Gene info will be inserted here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Level 5 Matching Game Area -->
            <div id="level-5-area" class="hidden">
                <div class="flex flex-col md:flex-row justify-around gap-6">
                    <!-- Symptoms Column (Draggable) -->
                    <div id="symptoms-column" class="flex flex-col gap-4 w-full md:w-1/2">
                        <!-- Symptoms will be generated by JS -->
                    </div>
                    <!-- Syndromes Column (Drop Zones) -->
                    <div id="syndromes-column" class="flex flex-col gap-4 w-full md:w-1/2">
                        <!-- Drop zones will be generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Toolbox for levels 1-3 -->
            <div id="toolbox-area" class="mt-8 pt-6 border-t-2 border-gray-600">
                <h3 class="text-lg font-semibold mb-4 text-center text-gray-400">‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Toolbox)</h3>
                <div id="toolbox" class="flex justify-center items-center gap-4 flex-wrap">
                    <div class="base base-A" draggable="true" data-base="A">A</div>
                    <div class="base base-T" draggable="true" data-base="T">T</div>
                    <div class="base base-C" draggable="true" data-base="C">C</div>
                    <div class="base base-G" draggable="true" data-base="G">G</div>
                </div>
            </div>
        </main>

    </div>

    <!-- Modal for messages -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-2xl p-6 sm:p-8 text-center shadow-xl border-4 border-indigo-500 max-w-md w-full transform transition-all scale-95 opacity-0" id="modal-content">
            <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold text-indigo-400 mb-4"></h2>
            <p id="modal-message" class="text-md sm:text-lg text-gray-300 mb-6 whitespace-pre-line"></p>
            <button id="modal-button" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300 transform hover:scale-105">
                ‡πÑ‡∏õ‡∏ï‡πà‡∏≠!
            </button>
        </div>
    </div>

    <!-- Final congratulations screen -->
    <div id="final-screen" class="hidden fixed inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4 z-50 text-white text-center">
        <div class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl max-w-3xl w-full border-4 border-amber-400 transform transition-all scale-95 opacity-0" id="final-content">
            <h2 class="text-3xl sm:text-4xl font-bold text-amber-400 mb-4">üéâ ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ! üéâ</h2>
            <p class="text-lg sm:text-xl mb-6">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°!</p>
            
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-8 text-md sm:text-lg mb-6 bg-gray-900 p-3 rounded-lg">
                <div><strong>üë©‚Äçüî¨ ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö:</strong> <span id="final-player-name"></span></div>
                <div><strong>‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</strong> <span id="final-time"></span></div>
                <div><strong>‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</strong> <span id="final-score"></span></div>
            </div>

            <div class="text-left bg-gray-700 p-4 sm:p-6 rounded-lg">
                <h3 class="text-xl sm:text-2xl font-semibold text-indigo-400 mb-4">‡∏Å‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏≤‡∏á DNA</h3>
                <p class="mb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÄ‡∏ä‡πà‡∏ô:</p>
                <ul class="list-disc list-inside space-y-3">
                    <li><strong>‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° (Genetic Engineering):</strong> ‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏¢‡∏µ‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡∏ä‡∏ó‡∏ô‡πÅ‡∏•‡πâ‡∏á (GMOs) ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏¢‡∏≤‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢</li>
                    <li><strong>‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏¢‡∏µ‡∏ô (Gene Therapy):</strong> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£ "‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ó‡∏î‡πÅ‡∏ó‡∏ô" ‡∏¢‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</li>
                    <li><strong>‡∏•‡∏≤‡∏¢‡∏ô‡∏¥‡πâ‡∏ß‡∏°‡∏∑‡∏≠‡∏î‡∏µ‡πÄ‡∏≠‡πá‡∏ô‡πÄ‡∏≠ (DNA Fingerprinting):</strong> ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ô‡∏¥‡∏ï‡∏¥‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏¢‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ó‡∏≥‡πÑ‡∏õ!</li>
                    <li><strong>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personalized Medicine):</strong> ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏≠‡∏≤‡∏à‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏´‡∏±‡∏™‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</li>
                </ul>
                <p class="mt-6 font-semibold">‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏µ‡∏Å‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢ ‡∏à‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞!</p>
            </div>

            <button id="restart-button" class="mt-8 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 transform hover:scale-105">
                ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            </button>
        </div>
    </div>


    <script>
        let startTime; // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        let playerName = "‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö"; // Default name
        const gameConfig = {
            level: 1,
            levels: {
                1: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™ DNA ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                    mission: "‡∏•‡∏≤‡∏Å‡πÄ‡∏ö‡∏™ (A, T, C, G) ‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÑ‡∏õ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!",
                    sequence: [], // Sequence will be generated randomly
                    completed: 0,
                },
                2: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏à‡∏≤‡∏Å‡∏¢‡∏µ‡∏ô‡∏™‡∏π‡πà‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ (‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢)",
                    mission: "",
                    targetTrait: '‡∏ï‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤', // This will be randomized
                    genes: {
                        '‡∏ï‡∏≤‡∏™‡∏µ‡∏ü‡πâ‡∏≤': { sequence: ['A', 'T', 'T', 'C', 'G', 'A'], emoji: 'üîµ', color: 'border-blue-400', face: 'üôÇ' },
                        '‡∏ï‡∏≤‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß': { sequence: ['G', 'C', 'C', 'A', 'T', 'G'], emoji: 'üü¢', color: 'border-green-400', face: 'üòä' },
                        '‡∏ú‡∏°‡∏™‡∏µ‡∏î‡∏≥': { sequence: ['C', 'G', 'A', 'T', 'A', 'T'], emoji: '‚¨õ', color: 'border-gray-400', face: 'üòé'},
                    },
                    completed: 0
                },
                3: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏¥‡∏ß‡πÄ‡∏ó‡∏ä‡∏±‡∏ô! (‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢)",
                    mission: "",
                    originalTrait: '', // Will be randomized
                    sequence: [],
                    mutationIndex: -1,
                    completed: 0
                },
                4: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°",
                    mission: "‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏î",
                    stage: 'guessing', // 'guessing' or 'confirming'
                    currentCase: null,
                    unsolvedCases: [],
                    cases: {
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå': { 
                            name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå (Down Syndrome)", errorChromosome: 21, type: 'trisomy', 
                            description: "‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 21 ‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤ 1 ‡πÅ‡∏ó‡πà‡∏á",
                            symptoms: "‚Ä¢ ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ï‡πà‡∏≥\n‚Ä¢ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢\n‚Ä¢ ‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏≠‡∏¢‡πÅ‡∏ö‡∏ô ‡∏ï‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏∂‡πâ‡∏ô\n‚Ä¢ ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏û‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î"
                        },
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå': {
                            name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå (Cri-du-chat Syndrome)", errorChromosome: 5, type: 'deletion',
                            description: "‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà 5 ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ",
                            symptoms: "‚Ä¢ ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å\n‚Ä¢ ‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÄ‡∏•‡πá‡∏Å ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏°\n‚Ä¢ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏´‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏°‡∏ß"
                        },
                        '‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå': {
                            name: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå (Turner Syndrome)", errorChromosome: 'X', type: 'monosomy',
                            description: "‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° X ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (XO)",
                            symptoms: "‚Ä¢ ‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢\n‚Ä¢ ‡∏Ñ‡∏≠‡∏°‡∏µ‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î‡∏Å‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏Å\n‚Ä¢ ‡∏£‡∏±‡∏á‡πÑ‡∏Ç‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏£‡∏¥‡∏ç ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏±‡∏ô"
                        }
                    },
                    chromosomeFound: false,
                },
                 5: {
                    title: "‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ",
                    mission: "‡∏•‡∏≤‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ö‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤",
                    completed: 0,
                    symptomPool: [],
                    currentSetSize: 0,
                    pairs: [
                        { symptom: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÅ‡∏´‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏°‡∏ß", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" },
                        { symptom: "‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏≠‡∏¢‡πÅ‡∏ö‡∏ô ‡∏ï‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏∂‡πâ‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" },
                        { symptom: "‡∏Ñ‡∏≠‡∏°‡∏µ‡∏û‡∏±‡∏á‡∏ú‡∏∑‡∏î‡∏Å‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏Å (‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á)", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" },
                        { symptom: "‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" },
                        { symptom: "‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÄ‡∏•‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏°", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" },
                        { symptom: "‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏±‡∏á‡πÑ‡∏Ç‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏£‡∏¥‡∏ç", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" },
                        { symptom: "‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏∏‡∏Å‡∏õ‡∏≤‡∏Å ‡πÄ‡∏™‡πâ‡∏ô‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡∏î‡∏Ç‡∏ß‡∏≤‡∏á", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" },
                        { symptom: "‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏¥‡∏î‡∏π‡∏ä‡∏≤‡∏ï‡πå" },
                        { symptom: "‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå" },
                        { symptom: "‡∏î‡∏±‡πâ‡∏á‡∏à‡∏°‡∏π‡∏Å‡πÅ‡∏ö‡∏ô", syndrome: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå" }
                    ]
                }
            },
            baseComplements: { 'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C' }
        };

        // DOM Elements
        const levelTitleEl = document.getElementById('level-title');
        const missionDescriptionEl = document.getElementById('mission-description');
        const gameAreaEl = document.getElementById('game-area');
        const level5AreaEl = document.getElementById('level-5-area');
        const templateAreaEl = document.getElementById('template-area');
        const templateStrandTitleEl = document.getElementById('template-strand-title');
        const templateStrandEl = document.getElementById('template-strand');
        const playerAreaEl = document.getElementById('player-area');
        const playerStrandTitleEl = document.getElementById('player-strand-title');
        const playerStrandEl = document.getElementById('player-strand');
        const toolboxAreaEl = document.getElementById('toolbox-area');
        const level2ContentEl = document.getElementById('level-2-content');
        const avatarEl = document.getElementById('avatar');
        const traitDisplayEl = document.getElementById('trait-display');
        const geneTableBodyEl = document.querySelector('#gene-table tbody');
        
        const modalEl = document.getElementById('modal');
        const modalContentEl = document.getElementById('modal-content');
        const modalTitleEl = document.getElementById('modal-title');
        const modalMessageEl = document.getElementById('modal-message');
        const modalButtonEl = document.getElementById('modal-button');

        function setupLevel(level) {
            const config = gameConfig.levels[level];
            levelTitleEl.textContent = config.title;
            missionDescriptionEl.textContent = config.mission;
            
            // Reset visibility for all areas first
            gameAreaEl.classList.add('hidden');
            toolboxAreaEl.classList.add('hidden');
            level2ContentEl.classList.add('hidden');
            level5AreaEl.classList.add('hidden');

            if (level === 1) setupLevel1();
            else if (level === 2) setupLevel2();
            else if (level === 3) setupLevel3();
            else if (level === 4) {
                const configLvl4 = gameConfig.levels[4];
                if (configLvl4.unsolvedCases.length === 0) {
                    const caseKeys = Object.keys(configLvl4.cases);
                     for (let i = caseKeys.length - 1; i > 0; i--) { // Shuffle
                        const j = Math.floor(Math.random() * (i + 1));
                        [caseKeys[i], caseKeys[j]] = [caseKeys[j], caseKeys[i]];
                    }
                    configLvl4.unsolvedCases = caseKeys;
                }
                setupLevel4();
            } else if (level === 5) setupLevel5();
        }
        
        function setupLevel1() {
            gameAreaEl.classList.remove('hidden');
            toolboxAreaEl.classList.remove('hidden');
            
            const config = gameConfig.levels[1];

            // --- START: Randomize DNA sequence for Level 1 ---
            const bases = ['A', 'T', 'C', 'G'];
            let newSequence = [...bases]; // Start with one of each base
            const desiredLength = 6;
            
            // Add random bases until the desired length is reached
            while (newSequence.length < desiredLength) {
                const randomBase = bases[Math.floor(Math.random() * bases.length)];
                newSequence.push(randomBase);
            }

            // Shuffle the sequence to make it random (Fisher-Yates shuffle)
            for (let i = newSequence.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newSequence[i], newSequence[j]] = [newSequence[j], newSequence[i]];
            }
            config.sequence = newSequence; // Update the level config with the new sequence
             config.completed = 0;
            // --- END: Randomize DNA sequence ---

            templateStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö (Template)';
            playerStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏•‡∏≤‡∏Å‡πÄ‡∏ö‡∏™‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)';
            templateStrandEl.innerHTML = '';
            playerStrandEl.innerHTML = '';
            config.sequence.forEach(base => {
                const templateBase = document.createElement('div');
                templateBase.className = `template-base base-${base}`;
                templateBase.textContent = base;
                templateStrandEl.appendChild(templateBase);

                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.target = gameConfig.baseComplements[base];
                playerStrandEl.appendChild(dropZone);
            });
            addDragAndDropListeners();
        }
        
        function setupLevel2() {
            gameAreaEl.classList.remove('hidden');
            toolboxAreaEl.classList.remove('hidden');
            level2ContentEl.classList.remove('hidden');
            templateAreaEl.classList.add('hidden');

            const config = gameConfig.levels[2];
            const availableTraits = Object.keys(config.genes);
            const randomTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
            config.targetTrait = randomTrait;

            config.mission = `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏° (Complementary) ‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '${config.targetTrait}' ‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á`;
            missionDescriptionEl.textContent = config.mission;
            
            updateAvatar('üòê', '‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è', 'border-gray-500');
            playerStrandTitleEl.textContent = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${config.targetTrait}' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà`;

            geneTableBodyEl.innerHTML = '';
            for (const trait in config.genes) {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600';
                row.innerHTML = `<td class="p-3">${trait} ${config.genes[trait].emoji}</td><td class="p-3 font-mono">${config.genes[trait].sequence.join('-')}</td>`;
                geneTableBodyEl.appendChild(row);
            }
            
            const targetSequence = config.genes[config.targetTrait].sequence;
            config.completed = 0;
            playerStrandEl.innerHTML = '';
            targetSequence.forEach(base => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.target = gameConfig.baseComplements[base];
                playerStrandEl.appendChild(dropZone);
            });
            addDragAndDropListeners();
        }
        
        function setupLevel3() {
            gameAreaEl.classList.remove('hidden');
            toolboxAreaEl.classList.remove('hidden');
            level2ContentEl.classList.remove('hidden');
            templateAreaEl.classList.remove('hidden');

            const level2Genes = gameConfig.levels[2].genes;
            const level3Config = gameConfig.levels[3];

            const availableTraits = Object.keys(level2Genes);
            const originalTrait = availableTraits[Math.floor(Math.random() * availableTraits.length)];
            level3Config.originalTrait = originalTrait;

            const originalSequence = [...level2Genes[originalTrait].sequence];
            const mutationIndex = Math.floor(Math.random() * originalSequence.length);
            level3Config.mutationIndex = mutationIndex;
            const originalBase = originalSequence[mutationIndex];
            const possibleBases = ['A', 'T', 'C', 'G'].filter(b => b !== originalBase);
            const mutatedBase = possibleBases[Math.floor(Math.random() * possibleBases.length)];
            const mutatedSequence = [...originalSequence];
            mutatedSequence[mutationIndex] = mutatedBase;
            level3Config.sequence = mutatedSequence;
            
            level3Config.mission = `üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏¥‡∏ß‡πÄ‡∏ó‡∏ä‡∏±‡∏ô! ‡∏™‡∏≤‡∏¢ DNA ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ú‡∏¥‡∏î‡πÑ‡∏õ 1 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${originalTrait}' ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà`;
            missionDescriptionEl.textContent = level3Config.mission;
            templateStrandTitleEl.textContent = '‡∏™‡∏≤‡∏¢ DNA ‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå (Mutated)';
            playerStrandTitleEl.textContent = `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏¢‡∏µ‡∏ô '${originalTrait}' ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;
            
            let mutatedTrait = '‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ú‡∏¥‡∏î‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô';
            let mutatedFace = 'ü§í';
            let mutatedColor = 'border-yellow-500';

            const mutatedSeqStr = mutatedSequence.join('');
            for (const trait in level2Genes) {
                if (level2Genes[trait].sequence.join('') === mutatedSeqStr) {
                    mutatedTrait = trait;
                    mutatedFace = level2Genes[trait].face;
                    mutatedColor = level2Genes[trait].color;
                    break;
                }
            }
            updateAvatar(mutatedFace, `‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô: ${mutatedTrait}`, mutatedColor);
            
            templateStrandEl.innerHTML = '';
            mutatedSequence.forEach((base, index) => {
                const templateBase = document.createElement('div');
                templateBase.className = `template-base base-${base}`;
                templateBase.textContent = base;
                templateStrandEl.appendChild(templateBase);
            });
            
            level3Config.completed = 0;
            playerStrandEl.innerHTML = '';
            originalSequence.forEach(base => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone';
                dropZone.dataset.target = gameConfig.baseComplements[base];
                playerStrandEl.appendChild(dropZone);
            });
            addDragAndDropListeners();
        }

        function setupLevel4() {
            gameAreaEl.classList.remove('hidden');
            templateAreaEl.classList.remove('hidden');
            playerAreaEl.classList.remove('hidden');

            const config = gameConfig.levels[4];
            
            if (config.unsolvedCases.length === 0) {
                 setupLevel(5); // Transition to level 5 if all cases are solved
                 return;
            }

            config.stage = 'guessing';
            config.chromosomeFound = false;
            
            const currentCaseKey = config.unsolvedCases[0];
            config.currentCase = config.cases[currentCaseKey];

            missionDescriptionEl.textContent = config.mission;
            
            templateStrandEl.innerHTML = '';
            templateStrandEl.className = 'dna-strand';
            const symptomsEl = document.createElement('div');
            symptomsEl.className = 'bg-gray-700 p-4 rounded-lg text-left whitespace-pre-line max-w-md';
            symptomsEl.textContent = config.currentCase.symptoms;
            templateStrandEl.appendChild(symptomsEl);
            
            templateStrandTitleEl.textContent = "‡πÅ‡∏ü‡πâ‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ";
            playerStrandTitleEl.textContent = "‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£";

            playerStrandEl.innerHTML = '';
            Object.keys(config.cases).forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'diagnosis-btn';
                btn.textContent = key;
                btn.dataset.syndrome = key;
                btn.disabled = false;
                btn.addEventListener('click', handleDiagnosisClick);
                playerStrandEl.appendChild(btn);
            });
        }
        
        function setupLevel5() {
            level5AreaEl.classList.remove('hidden');
            const config = gameConfig.levels[5];
            missionDescriptionEl.textContent = config.mission;
            
            if (config.symptomPool.length === 0) {
                 config.symptomPool = [...config.pairs].sort(() => Math.random() - 0.5);
            }
            
            displayNextSymptomSet();
        }
        
        function displayNextSymptomSet() {
            const config = gameConfig.levels[5];
            const symptomsColumn = document.getElementById('symptoms-column');
            const syndromesColumn = document.getElementById('syndromes-column');
            symptomsColumn.innerHTML = '';
            syndromesColumn.innerHTML = '';

            const currentSymptoms = config.symptomPool.splice(0, 5);
            if (currentSymptoms.length === 0) {
                showFinalScreen();
                return;
            }

            config.currentSetSize = currentSymptoms.length;
            config.completed = 0;

            currentSymptoms.forEach(pair => {
                const symptomEl = document.createElement('div');
                symptomEl.className = 'symptom-item bg-gray-700 p-4 rounded-lg cursor-grab';
                symptomEl.textContent = pair.symptom;
                symptomEl.draggable = true;
                symptomEl.dataset.syndrome = pair.syndrome;
                symptomEl.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.syndrome);
                    e.dataTransfer.setData('text/symptom', e.target.textContent);
                    e.target.classList.add('opacity-50');
                });
                symptomEl.addEventListener('dragend', e => e.target.classList.remove('opacity-50'));
                symptomsColumn.appendChild(symptomEl);
            });
            
             Object.keys(gameConfig.levels[4].cases).forEach(syndrome => {
                const syndromeEl = document.createElement('div');
                syndromeEl.className = 'syndrome-dropzone bg-gray-900 p-4 rounded-lg border-2 border-dashed border-gray-500 flex flex-col gap-2 min-h-[120px]';
                syndromeEl.dataset.syndrome = syndrome;
                syndromeEl.innerHTML = `<h4 class="font-bold text-indigo-400 mb-2 pointer-events-none">${syndrome}</h4>`;

                syndromeEl.addEventListener('dragover', e => e.preventDefault());
                syndromeEl.addEventListener('dragenter', e => e.currentTarget.classList.add('bg-gray-700', 'border-indigo-400'));
                syndromeEl.addEventListener('dragleave', e => e.currentTarget.classList.remove('bg-gray-700', 'border-indigo-400'));
                syndromeEl.addEventListener('drop', handleSymptomDrop);
                
                syndromesColumn.appendChild(syndromeEl);
            });
        }


        function handleSymptomDrop(e) {
            e.preventDefault();
            const dropZone = e.currentTarget;
            const droppedSyndrome = e.dataTransfer.getData('text/plain');
            const droppedSymptomText = e.dataTransfer.getData('text/symptom');
            const targetSyndrome = dropZone.dataset.syndrome;
            
            dropZone.classList.remove('bg-gray-700', 'border-indigo-400');

            const originalSymptomEl = Array.from(document.querySelectorAll('.symptom-item')).find(el => el.textContent === droppedSymptomText);

            if (droppedSyndrome === targetSyndrome) {
                if (originalSymptomEl) originalSymptomEl.remove();

                const droppedItem = document.createElement('div');
                droppedItem.className = 'bg-green-800/80 p-2 rounded w-full text-center text-sm';
                droppedItem.textContent = droppedSymptomText;
                dropZone.appendChild(droppedItem);
                
                gameConfig.levels[5].completed++;
                checkCompletion();
            } else {
                 if (originalSymptomEl) {
                    originalSymptomEl.classList.add('shake');
                    setTimeout(() => originalSymptomEl.classList.remove('shake'), 300);
                 }
            }
        }


        function createChromosomePair(num, caseData) {
            const pair = document.createElement('div');
            pair.className = 'chromosome-pair';
            pair.dataset.chromosome = num;
            pair.textContent = `${num}`;
            if (num === caseData.errorChromosome) pair.dataset.correct = 'true';
            if (caseData.name.includes('‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏≠‡∏£‡πå') && num === 'Y') pair.style.display = 'none';
            pair.addEventListener('click', handleKaryotypeClick);
            return pair;
        }
        
        function handleDiagnosisClick(e) {
            const config = gameConfig.levels[4];
            if (config.stage !== 'guessing') return;

            const clickedBtn = e.currentTarget;
            const selectedSyndrome = clickedBtn.dataset.syndrome;
            const currentCase = config.currentCase;

            if (selectedSyndrome === currentCase.name.split(' (')[0]) {
                config.stage = 'confirming';
                missionDescriptionEl.textContent = "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏ó‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Karyotype ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏π‡πà‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô";

                playerStrandEl.querySelectorAll('.diagnosis-btn').forEach(btn => btn.disabled = true);
                clickedBtn.classList.add('correct-selection');
                
                templateStrandEl.innerHTML = '';
                templateStrandEl.className = 'karyotype-container';
                templateStrandTitleEl.textContent = "Karyotype ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥)";
                playerStrandTitleEl.textContent = "‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß)";

                for (let i = 1; i <= 22; i++) templateStrandEl.appendChild(createChromosomePair(i, currentCase));
                templateStrandEl.appendChild(createChromosomePair('X', currentCase));
                templateStrandEl.appendChild(createChromosomePair('Y', currentCase));

            } else {
                clickedBtn.classList.add('shake');
                setTimeout(() => clickedBtn.classList.remove('shake'), 300);
            }
        }
        
        function handleKaryotypeClick(e) {
            const config = gameConfig.levels[4];
            if (config.stage !== 'confirming' || config.chromosomeFound) return;
            
            const clickedPair = e.currentTarget;
            if (clickedPair.dataset.correct === 'true') {
                config.chromosomeFound = true;
                clickedPair.classList.add('correct-selection');
                missionDescriptionEl.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á";
                
                const currentCase = config.currentCase;
                config.unsolvedCases.shift();
                const moreCases = config.unsolvedCases.length > 0;

                setTimeout(() => {
                    showModal(
                        '‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        `‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏õ‡πá‡∏ô ${currentCase.name}\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ${currentCase.description}\n\n‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡πà‡∏ô:\n${currentCase.symptoms}`,
                        moreCases ? '‡∏Ñ‡∏î‡∏µ‡∏ï‡πà‡∏≠‡πÑ‡∏õ' : '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 5',
                        moreCases ? setupLevel4 : () => { gameConfig.level = 5; setupLevel(5); }
                    );
                }, 1200);

            } else {
                clickedPair.classList.add('shake');
                setTimeout(() => clickedPair.classList.remove('shake'), 300);
            }
        }


        function updateAvatar(face, traitText, borderColorClass) {
            avatarEl.textContent = face;
            traitDisplayEl.textContent = traitText;
            avatarEl.className = avatarEl.className.replace(/border-[\w-]+/, borderColorClass);
        }

        function addDragAndDropListeners() {
            document.querySelectorAll('#toolbox .base').forEach(base => {
                base.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', e.target.dataset.base));
            });
            playerStrandEl.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', e => e.preventDefault());
                zone.addEventListener('dragenter', e => { if (!e.target.dataset.filled) e.target.classList.add('hovered'); });
                zone.addEventListener('dragleave', e => e.target.classList.remove('hovered'));
                zone.addEventListener('drop', drop);
            });
        }
        
        function drop(e) {
            e.preventDefault();
            const zone = e.currentTarget;
            if (zone.dataset.filled) return;
            
            zone.classList.remove('hovered');
            const droppedBase = e.dataTransfer.getData('text/plain');
            const targetBase = zone.dataset.target;

            if (droppedBase === targetBase) {
                zone.className = `drop-zone correct base-${droppedBase}`;
                zone.textContent = droppedBase;
                zone.dataset.filled = 'true';
                gameConfig.levels[gameConfig.level].completed++;
                checkCompletion();
            } else {
                zone.classList.add('shake');
                setTimeout(() => zone.classList.remove('shake'), 300);
            }
        }
        
        function checkCompletion() {
            if (gameConfig.level <= 3) {
                const config = gameConfig.levels[gameConfig.level];
                let total;
                if (gameConfig.level === 1) total = config.sequence.length;
                else if (gameConfig.level === 2) total = config.genes[config.targetTrait].sequence.length;
                else if (gameConfig.level === 3) total = gameConfig.levels[2].genes[config.originalTrait].sequence.length;

                if (config.completed === total) {
                    if (gameConfig.level === 1) {
                        showModal('‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!', '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏¢ DNA ‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏£‡∏∂‡∏¢‡∏±‡∏á?', '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2', () => { gameConfig.level = 2; setupLevel(2); });
                    } else if (gameConfig.level === 2) {
                        const traitInfo = config.genes[config.targetTrait];
                        updateAvatar(traitInfo.face, `‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${config.targetTrait}`, traitInfo.color);
                        showModal('‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å!', `‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö '${config.targetTrait}' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ß‡∏±‡∏á...‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠...`, '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3', () => { gameConfig.level = 3; setupLevel(3); });
                    } else if (gameConfig.level === 3) {
                        const originalTrait = config.originalTrait;
                        const traitInfo = gameConfig.levels[2].genes[originalTrait];
                        updateAvatar(traitInfo.face, `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${originalTrait}`, traitInfo.color);
                        showModal('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ñ‡∏∏‡∏ì‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏£‡∏´‡∏±‡∏™ DNA ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ! ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢', '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4', () => { gameConfig.level = 4; setupLevel(4); });
                    }
                }
            } else if (gameConfig.level === 5) {
                const config = gameConfig.levels[5];
                if (config.completed === config.currentSetSize) {
                    if (config.symptomPool.length > 0) {
                        showModal('‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!', '‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡∏∏‡∏î‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏¢!', '‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 2', displayNextSymptomSet);
                    } else {
                        showModal('‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ñ‡∏∏‡∏ì‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏ô‡∏±‡∏Å‡∏™‡∏∑‡∏ö‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°!', '‡∏î‡∏π‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', showFinalScreen);
                    }
                }
            }
        }

        function showModal(title, message, buttonText, callback) {
            modalTitleEl.textContent = title;
            modalMessageEl.textContent = message;
            modalButtonEl.textContent = buttonText;
            
            modalButtonEl.onclick = () => {
                modalContentEl.classList.remove('scale-100', 'opacity-100');
                modalContentEl.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modalEl.classList.add('hidden');
                    if (callback) callback();
                }, 200);
            };
            
            modalEl.classList.remove('hidden');
            setTimeout(() => {
                modalContentEl.classList.remove('scale-95', 'opacity-0');
                modalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function showFinalScreen() {
            const endTime = new Date();
            const timeDiff = endTime - startTime; // in milliseconds
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);

            let score = 0;
            const totalMinutes = timeDiff / 60000;
            if (totalMinutes < 2) score = 5;
            else if (totalMinutes <= 5) score = 4;
            else if (totalMinutes <= 8) score = 3;
            else if (totalMinutes <= 10) score = 2;
            else score = 1;

            document.getElementById('final-player-name').textContent = playerName;
            document.getElementById('final-time').textContent = `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds.toString().padStart(2, '0')} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
            document.getElementById('final-score').textContent = `${score} / 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
            
            const finalScreenEl = document.getElementById('final-screen');
            const finalContentEl = document.getElementById('final-content');
            const restartButtonEl = document.getElementById('restart-button');

            document.getElementById('game-container').classList.add('hidden');
            modalEl.classList.add('hidden');

            finalScreenEl.classList.remove('hidden');
            setTimeout(() => {
                finalContentEl.classList.remove('scale-95', 'opacity-0');
                finalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);

            restartButtonEl.onclick = () => {
                restartButtonEl.disabled = true;
                restartButtonEl.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà...";
                location.reload();
            };
        }

        window.onload = () => {
            document.getElementById('start-button').addEventListener('click', () => {
                const nameInput = document.getElementById('player-name-input').value.trim();
                if (nameInput) {
                    playerName = nameInput;
                }

                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('game-container').classList.remove('hidden');
                startTime = new Date(); // Start timer on click
                setupLevel(1); // Setup level 1 on click
            });
        };
    </script>
</body>
</html>
